<div class="container !mx-auto !my-8 !p-8 !bg-white !shadow-xl !rounded-2xl">
  <h2 class="!text-3xl !font-bold !text-gray-800 !mb-10 !border-b !pb-4">
    <ng-container *ngIf="prodForm.get('_id')?.value; else createProduct">
      🛒 Edit Product
    </ng-container>
    <ng-template #createProduct>
      🛒 Insert New Product
    </ng-template>
  </h2>

  <form [formGroup]="prodForm" (ngSubmit)="onSubmit()" class="grid grid-cols-1 lg:grid-cols-2 gap-10">

    <div class="!space-y-6">
      <div>
        <label class="!block !text-gray-700 !font-semibold !mb-2">Name (EN)</label>
        <input pInputText formControlName="nameEN" placeholder="Product name in English"
          class="!w-full !p-3 !rounded-lg" />
        <div *ngIf="prodForm.controls['nameEN'].invalid && prodForm.controls['nameEN'].touched"
          class="!text-red-500 !text-sm">
          Name in English is required.
        </div>
      </div>

      <div>
        <label class="!block !text-gray-700 !font-semibold !mb-2">Name (AR)</label>
        <input pInputText formControlName="nameAR" placeholder="اسم المنتج بالعربية" class="!w-full !p-3 !rounded-lg" />
        <div *ngIf="prodForm.controls['nameAR'].invalid && prodForm.controls['nameAR'].touched"
          class="!text-red-500 !text-sm">
          Name in Arabic is required.
        </div>
      </div>

      <div>
        <label class="!block !text-gray-700 !font-semibold !mb-2">Description (EN)</label>
        <input pInputText [style]="{'width':'100%', 'height':'120px', 'padding':'0.75rem'}"
          formControlName="descriptionEN" placeholder="Description in English" class="!w-full !rounded-lg border" />
      </div>

      <div>
        <label class="!block !text-gray-700 !font-semibold !mb-2">Description (AR)</label>
        <input pInputText [style]="{'width':'100%', 'height':'120px', 'padding':'0.75rem'}"
          formControlName="descriptionAR" placeholder="الوصف بالعربية" class="!w-full !rounded-lg border" />
      </div>

      <div>
        <label class="!block !text-gray-700 !font-semibold !mb-2">Main Image</label>
        <p-fileupload name="mainImage" [customUpload]="true" (onSelect)="onSelectMainImage($event)" accept="image/*"
          maxFileSize="1000000" mode="basic" chooseLabel="Choose Image" />
        <div *ngIf="mainImageUrl" class="!mt-3">
          <img [src]="mainImageUrl" class="!w-52 !rounded !shadow-md" />
        </div>
      </div>

      <div>
        <label class="!block !text-gray-700 !font-semibold !mb-2">Additional Images</label>
        <p-fileupload name="additionalImages" [customUpload]="true" (onSelect)="onSelectImages($event)" accept="image/*"
          maxFileSize="1000000" mode="basic" multiple="true" chooseLabel="Choose Images" />
        <div *ngIf="imageUrls.length > 0" class="!mt-3 !flex !gap-2">
          <img *ngFor="let url of imageUrls" [src]="url" class="!w-24 !rounded !shadow-md" />
        </div>
      </div>
    </div>

    <div class="!space-y-6">
      <div>
        <label class="!block !text-gray-700 !font-semibold !mb-2">Brand</label>
        <input pInputText formControlName="brand" placeholder="Brand" class="!w-full !p-3 !rounded-lg" />
      </div>

      <div>
        <label class="!block !text-gray-700 !font-semibold !mb-2">Category</label>
        <p-dropdown [options]="categories" formControlName="categories.main" optionLabel="name.en" optionValue="_id"
          placeholder="Select a category" class="!w-full"></p-dropdown>
        <div *ngIf="prodForm.get('categories.main')?.invalid && prodForm.get('categories.main')?.touched"
          class="!text-red-500 !text-sm">
          Category is required.
        </div>
      </div>

      <div>
        <label class="!block !text-gray-700 !font-semibold !mb-2">Subcategory</label>
        <p-dropdown [options]="subcategories" formControlName="categories.sub" optionLabel="name.en" optionValue="_id"
          placeholder="Select a subcategory" class="!w-full"></p-dropdown>
      </div>

      <div class="!grid !grid-cols-2 !gap-4">
        <div>
          <label class="!block !text-gray-700 !font-semibold !mb-2">Material (EN)</label>
          <input pInputText formControlName="materialEN" placeholder="Material in English"
            class="!w-full !p-3 !rounded-lg" />
        </div>

        <div>
          <label class="!block !text-gray-700 !font-semibold !mb-2">Material (AR)</label>
          <input pInputText formControlName="materialAR" placeholder="الخامة بالعربية"
            class="!w-full !p-3 !rounded-lg" />
        </div>
      </div>
    </div>

    <div class="!col-span-2 !mt-8 !border-t !pt-6">
      <h3 class="!text-xl !font-semibold !text-gray-800 !mb-4">Product Variants</h3>
      <div formArrayName="variants" *ngFor="let variant of variants.controls; let i = index" [formGroupName]="i"
        class="!mb-6 !p-4 !border !rounded-md">
        <h4 class="!text-lg !font-semibold !text-gray-700 !mb-3">Variant #{{ i + 1 }}</h4>

        <div class="!grid !grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div>
            <label class="!block !text-gray-700 !font-semibold !mb-2">Name (EN)</label>
            <input pInputText formControlName="name.en" placeholder="Variant Name in English"
              class="!w-full !p-3 !rounded-lg" />
            <div *ngIf="variants.controls[i].get('name.en')?.invalid && variants.controls[i].get('name.en')?.touched"
              class="!text-red-500 !text-sm">
              Name in English is required.
            </div>
          </div>

          <div>
            <label class="!block !text-gray-700 !font-semibold !mb-2">Name (AR)</label>
            <input pInputText formControlName="name.ar" placeholder="اسم النوع بالعربية"
              class="!w-full !p-3 !rounded-lg" />
            <div *ngIf="variants.controls[i].get('name.ar')?.invalid && variants.controls[i].get('name.ar')?.touched"
              class="!text-red-500 !text-sm">
              Name in Arabic is required.
            </div>
          </div>

          <div>
            <label class="!block !text-gray-700 !font-semibold !mb-2">Price</label>
            <p-inputnumber formControlName="price" mode="currency" currency="USD" class="!w-full !p-2 !rounded-lg">
            </p-inputnumber>
            <div *ngIf="variants.controls[i].get('price')?.invalid && variants.controls[i].get('price')?.touched"
              class="!text-red-500 !text-sm">
              Price is required.
            </div>
          </div>

          <div>
            <label class="!block !text-gray-700 !font-semibold !mb-2">Color (EN)</label>
            <input pInputText formControlName="color.en" placeholder="Color in English"
              class="!w-full !p-3 !rounded-lg" />
          </div>

          <div>
            <label class="!block !text-gray-700 !font-semibold !mb-2">Color (AR)</label>
            <input pInputText formControlName="color.ar" placeholder="اللون بالعربية"
              class="!w-full !p-3 !rounded-lg" />
          </div>

          <div>
            <label class="!block !text-gray-700 !font-semibold !mb-2">In Stock</label>
            <p-inputnumber formControlName="inStock" mode="decimal" [useGrouping]="false"
              class="!w-full !p-2 !rounded-lg"></p-inputnumber>
            <div *ngIf="variants.controls[i].get('inStock')?.invalid && variants.controls[i].get('inStock')?.touched"
              class="!text-red-500 !text-sm">
              In Stock is required.
            </div>
          </div>

          <div>
            <label class="!block !text-gray-700 !font-semibold !mb-2">Discount Price</label>
            <p-inputnumber formControlName="discountPrice" mode="currency" currency="USD"
              class="!w-full !p-2 !rounded-lg"></p-inputnumber>
          </div>

          <div>
            <label class="!block !text-gray-700 !font-semibold !mb-2">Image</label>
            <p-fileupload name="variantImage" [customUpload]="true" (onSelect)="onSelectVariantImage($event, i)"
              accept="image/*" maxFileSize="1000000" mode="basic" chooseLabel="Choose Image" />
            <div *ngIf="variantImages[i]" class="!mt-3">
              <img [src]="variantImages[i]" class="!w-32 !rounded !shadow-md" />
            </div>
          </div>
        </div>

        <button pButton type="button" (click)="removeVariant(i)" icon="pi pi-trash"
          class="!p-button-danger !mt-4"></button>
      </div>

      <button pButton type="button" (click)="addVariant()" label="Add Variant" class="!p-button-success !mt-4"></button>
    </div>

    <div class="!md:col-span-2 !mt-8 !text-center">
      <button pButton type="submit" label="Save Product"
        class="!p-button-success !px-8 !py-3 !text-lg !rounded-lg !shadow" [disabled]="prodForm.invalid"></button>
    </div>
  </form>
</div>